{"version":3,"file":"create_component_from_python_function_text-CTH31WE9.js","sources":["../../../src/components/shared/ComponentEditor/generators/create_component_from_python_function_text.py?raw"],"sourcesContent":["export default \"import importlib\\nimport pathlib\\nimport json\\nfrom cloud_pipelines import components\\n\\n\\ndef create_component_from_python_function_text(\\n    python_function_text: str,\\n    base_image: str = \\\"python:3.12\\\",\\n    packages_to_install: list[str] = None,\\n    annotations: dict[str, str] = None,\\n    function_name: str = None,\\n    add_metadata_annotations: bool = True,\\n):\\n    pathlib.Path(\\\"component_code.py\\\").write_text(python_function_text)\\n    # Issue: For some reason, despite importlib.reload, Pyodide retains\\n    # the original module attributes (like the old function), so the\\n    # new module is concatenated with the old one, causing there to be two functions.\\n    # Fortunately, deleting the module from sys.modules fixes this.\\n    import sys\\n    try:\\n        del sys.modules[\\\"component_code\\\"]\\n    except:\\n        pass\\n    import component_code\\n\\n    importlib.reload(component_code)\\n\\n    if function_name:\\n        function = getattr(component_code, function_name)\\n    else:\\n        functions = []\\n        for name in dir(component_code):\\n            if not name.startswith(\\\"_\\\"):\\n                obj = getattr(component_code, name)\\n                if callable(obj) and not isinstance(obj, type):\\n                    functions.append(obj)\\n        if not functions:\\n            raise ValueError(f\\\"Could not find any functions in code.\\\")\\n\\n        if len(functions) > 1:\\n            raise ValueError(\\n                f\\\"Found multiple functions in code. Please specify function-name=name. Functions: {[func.__name__ for func in functions]}\\\"\\n            )\\n        function = functions[0]\\n    \\n    if add_metadata_annotations:\\n        annotations = annotations or {}\\n        annotations[\\\"python_original_code\\\"] = python_function_text\\n        if packages_to_install:\\n            annotations[\\\"python_dependencies\\\"] = json.dumps(packages_to_install)\\n        annotations[\\\"cloud-pipelines.net\\\"] = \\\"true\\\"\\n        annotations[\\\"cloud-pipelines.net/pipeline-studio-app\\\"] = \\\"true\\\"\\n\\n    op = components.create_component_from_func(\\n        func=function,\\n        base_image=base_image,\\n        packages_to_install=packages_to_install,\\n        annotations=annotations,\\n        output_component_file=\\\"component.yaml\\\",\\n    )\\n    component_text = pathlib.Path(\\\"component.yaml\\\").read_text()\\n    \\n    return component_text\""],"names":["create_component_from_python_function_text"],"mappings":"AAAA,MAAAA,EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;"}